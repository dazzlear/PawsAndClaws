@model PawsAndClaws.Models.Pet
@{
    var isAdmin = ViewData["IsAdmin"] as bool? ?? false;
}

<div class="pet-card relative w-72 h-[400px] rounded-3xl overflow-hidden shadow-lg group mx-auto transition-transform transform @(isAdmin ? "" : "hover:scale-[1.02]") pointer-events-none"
     data-species="@Model.Species"
     data-gender="@Model.Gender"
     data-size="@Model.Size"
     data-status="@Model.Status"
     data-name="@Model.Name.ToLower()"
     data-breed="@Model.Breed.ToLower()">
    @if (!isAdmin)
    {
        <a href="@Url.Action("Details", "Home", new { name = Model.Name })" class="absolute inset-0 z-10 pointer-events-auto" style="cursor:pointer;" aria-label="View details for @Model.Name"></a>
    }
    <img src="@Url.Content(Model.ImageUrl)" class="absolute inset-0 w-full h-full object-cover" />
    
    <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent"></div>

    <div class="absolute top-5 right-5">
        @{
            var statusVariant = Model.Status.ToLower() switch {
                "pending" => "info",
                "adopted" => "neutral",
                "available" => "success",
                _ => "neutral"
            };
        }
        <partial name="_Badge" model='new BadgeViewModel { Text = Model.Status, Variant = statusVariant }' />
    </div>

    <div class="absolute bottom-0 p-8 text-white w-full">
        <div class="flex justify-between items-end">
            <div class="flex-1">
                <h2 class="text-xl font-bold mb-2">@Model.Name</h2>
                <p class="text-xs opacity-90">@Model.Breed • @Model.Age @(Model.Age == 1 ? "year" : "years") • @Model.Gender</p>
                <p class="text-xs mt-2 flex items-center"><i data-lucide="map-pin" class="w-4 h-4 mr-2"></i> @Model.Location</p>
            </div>

            @if (isAdmin)
            {
                @* Action Menu Dropdown for Admin *@
                <div class="relative dropdown-container pointer-events-auto">
                    <button class="p-2 text-white/80 hover:text-white transition-colors dropdown-trigger">
                        <i data-lucide="more-vertical" class="w-6 h-6"></i>
                    </button>
                    
                    <div class="hidden absolute right-0 bottom-full mb-2 w-36 bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden py-1 z-50 dropdown-menu">
                        <button type="button" onclick="openEditPetModal()" class="w-full flex items-center gap-3 px-4 py-2 text-[10px] font-black text-orange-400 hover:bg-orange-50 transition-colors uppercase tracking-widest">
                            <i data-lucide="edit-3" class="w-4 h-4"></i>
                            Edit Pet
                        </button>
                        <button class="w-full flex items-center gap-3 px-4 py-2 text-[10px] font-black text-gray-400 hover:bg-gray-50 transition-colors uppercase tracking-widest">
                            <i data-lucide="trash-2" class="w-4 h-4"></i>
                            Delete Pet
                        </button>
                    </div>
                </div>
            }
        </div>
        
        @{
            var btnText = "ADOPT NOW";
            var btnVariant = "primary";
            string? btnIcon = "arrow-right";
            var btnClass = "mt-4 w-full pointer-events-auto";

            if (string.Equals(Model.Status, "Pending", StringComparison.OrdinalIgnoreCase))
            {
                btnText = "PENDING";
                btnVariant = "outline";
                btnIcon = null;
                // Adjust for the dark background
                btnClass += " text-white border-white hover:bg-white/20 hover:text-white";
            }
            else if (string.Equals(Model.Status, "Adopted", StringComparison.OrdinalIgnoreCase))
            {
                btnText = "ADOPTED";
                btnVariant = "outline";
                btnIcon = null;
                // Adjust for the dark background
                btnClass += " text-white hover:bg-white/20 hover:text-white";
            }
        }
        @if (!isAdmin)
        {
            <partial name="_Button" model='new ButtonViewModel { Text = btnText, Variant = btnVariant, Icon = btnIcon, ClassName = btnClass }' />
        }
    </div>
</div>