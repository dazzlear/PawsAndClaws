@using PawsAndClaws.Models.ViewModels
@model RegisterViewModel

@{
    Layout = "_AuthLayout";
    ViewData["Title"] = "Join the Family";
}

@section AuthImages {
    <img src="~/images/Register.png" 
         alt="Registration Illustration" 
         class="absolute bottom-0 left-0 w-64 md:w-80 lg:w-[400px] h-auto pointer-events-none select-none z-0 hidden md:block" />

    <img src="~/images/Paws.png" 
         alt="Decorative Paw" 
         class="absolute right-16 top-1/2 -translate-y-1/2 w-48 lg:w-72 h-auto pointer-events-none select-none z-0" />
}

<partial name="_AuthHeader" model='("Your friend", "awaits", "Find your fur-ever bestfriend.", (int?)1)' />

<div class="bg-white rounded-[40px] shadow-sm p-8 md:p-12 w-full">
    
    <form asp-action="Register" method="post" id="registerForm" class="w-full space-y-5">
        @Html.AntiForgeryToken()
                <div class="flex flex-col md:flex-row gap-4">
                    <div class="relative flex-1">
                        <i data-lucide="user" class="absolute left-4 top-3.5 w-5 h-5 text-orange-300"></i>
                        <input asp-for="FirstName" placeholder="First Name" class="w-full pl-12 pr-4 py-3 bg-white border border-gray-100 rounded-2xl text-sm focus:outline-none focus:ring-2 focus:ring-teal-100 transition-all" />
                    </div>
                    <div class="relative flex-1">
                        <i data-lucide="user" class="absolute left-4 top-3.5 w-5 h-5 text-orange-300"></i>
                        <input asp-for="LastName" placeholder="Last Name" class="w-full pl-12 pr-4 py-3 bg-white border border-gray-100 rounded-2xl text-sm focus:outline-none focus:ring-2 focus:ring-teal-100 transition-all" />
                    </div>
                </div>

                <div class="relative">
                    <i data-lucide="mail" class="absolute left-4 top-3.5 w-5 h-5 text-orange-300"></i>
                    <input asp-for="Email" type="email" placeholder="Email Address" class="w-full pl-12 pr-4 py-3 bg-white border border-gray-100 rounded-2xl text-sm focus:outline-none focus:ring-2 focus:ring-teal-100 transition-all" />
                    <span asp-validation-for="Email" class="text-red-600 text-xs ml-4 mt-1 block"></span>
                </div>


                <div class="relative">
                    <i data-lucide="lock" class="absolute left-4 top-3.5 w-5 h-5 text-orange-300"></i>

                    <input asp-for="Password"
                           id="passwordInput"
                           type="password"
                           placeholder="Password"
                           class="w-full pl-12 pr-12 py-3 bg-white border border-gray-100 rounded-2xl text-sm focus:outline-none focus:ring-2 focus:ring-teal-100 transition-all" />

                    <button type="button"
                            id="togglePassword"
                            class="absolute right-4 top-3.5 w-5 h-5 text-gray-300 cursor-pointer">
                        <i data-lucide="eye" class="w-5 h-5"></i>
                    </button>

                    <span asp-validation-for="Password" class="text-red-600 text-xs ml-4 mt-1 block"></span>
                </div>

                <div class="relative">
                    <i data-lucide="lock" class="absolute left-4 top-3.5 w-5 h-5 text-orange-300"></i>

                    <input asp-for="ConfirmPassword"
                           id="confirmPasswordInput"
                           type="password"
                           placeholder="Confirm Password"
                           class="w-full pl-12 pr-12 py-3 bg-white border border-gray-100 rounded-2xl text-sm focus:outline-none focus:ring-2 focus:ring-teal-100 transition-all" />

                    <button type="button"
                            id="toggleConfirmPassword"
                            class="absolute right-4 top-3.5 w-5 h-5 text-gray-300 cursor-pointer">
                        <i data-lucide="eye" class="w-5 h-5"></i>
                    </button>

                    <span asp-validation-for="ConfirmPassword" class="text-red-600 text-xs ml-4 mt-1 block"></span>
                </div>

                <button type="submit" class="w-full bg-gradient-to-r from-[#178F85] via-[#66BBB4] to-[#90EFE7] text-white font-bold py-4 rounded-full shadow-lg shadow-teal-100 flex items-center justify-center gap-2 hover:opacity-90 transition-all transform hover:scale-[1.01] active:scale-[0.99] mt-8">
                    Join the Family
                    <i data-lucide="arrow-right" class="w-5 h-5"></i>
                </button>

                <p class="text-center text-sm text-gray-400 mt-6">
            Already have an account? <a asp-controller="Account" asp-action="Login" class="text-orange-500 font-bold hover:underline">Login here</a>
                </p>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                const togglePasswordBtn = document.querySelector('#togglePassword');
                const passwordInput = document.querySelector('#passwordInput');

                const toggleConfirmBtn = document.querySelector('#toggleConfirmPassword');
                const confirmInput = document.querySelector('#confirmPasswordInput');

                // PASSWORD
                if (togglePasswordBtn && passwordInput) {
                    togglePasswordBtn.addEventListener('click', function () {
                        const isPassword = passwordInput.getAttribute('type') === 'password';
                        passwordInput.setAttribute('type', isPassword ? 'text' : 'password');

                        const iconName = isPassword ? 'eye-off' : 'eye';
                        togglePasswordBtn.innerHTML = `<i data-lucide="${iconName}" class="w-5 h-5"></i>`;
                        if (window.lucide) window.lucide.createIcons();
                    });
                }

                // CONFIRM PASSWORD
                if (toggleConfirmBtn && confirmInput) {
                    toggleConfirmBtn.addEventListener('click', function () {
                        const isPassword = confirmInput.getAttribute('type') === 'password';
                        confirmInput.setAttribute('type', isPassword ? 'text' : 'password');

                        const iconName = isPassword ? 'eye-off' : 'eye';
                        toggleConfirmBtn.innerHTML = `<i data-lucide="${iconName}" class="w-5 h-5"></i>`;
                        if (window.lucide) window.lucide.createIcons();
                    });
                }
            });

            // only block submit when invalid
            if (!firstName || !lastName || !email || !password || !confirmPassword) {
              e.preventDefault();
              ModalManager.show(
                "All fields required",
                "Please fill in all the fields to continue with your registration.",
                "GOT IT"
              );
              return;
            }

            if (password !== confirmPassword) {
              e.preventDefault();
              ModalManager.show(
                "Passwords don't match",
                "Make sure both password fields are identical.",
                "TRY AGAIN"
              );
              return;
            }

            if (password.length < 6) {
              e.preventDefault();
              ModalManager.show(
                "Password too short",
                "Your password should be at least 6 characters long.",
                "GOT IT"
              );
              return;
            }

            // VALID → do nothing, allow normal submit to Account/Register (Step 2 redirect)
          });
        });
    </script>

}