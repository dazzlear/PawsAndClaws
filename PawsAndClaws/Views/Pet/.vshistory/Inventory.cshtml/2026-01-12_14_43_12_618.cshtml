@model IEnumerable<PawsAndClaws.Models.Entities.Pet>
@{
    Layout = "_Layout";
    ViewData["Title"] = "Pet Inventory";
    ViewData["IsAdmin"] = true;
    
    // Calculate status counts and create filter model
    var statusCounts = new Dictionary<string, int>
    {
        { "All", Model.Count() },
        { "Available", Model.Count(p => p.Status == "Available") },
        { "Pending", Model.Count(p => p.Status == "Pending") },
        { "Adopted", Model.Count(p => p.Status == "Adopted") }
    };
}

<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <!-- Header Section -->
    <div class="mb-10 flex items-start justify-between gap-8">
        <div>
            <h1 class="text-4xl font-black text-[#2D2D2D] mb-2" style="font-family: 'Lilita One', cursive;">
                <span class="text-[#F87004]">Pet </span><span class="text-[#56C2B1]">Inventory</span>
            </h1>
            <p class="text-gray-600 font-medium">Manage all pets currently listed in the shelter.</p>
        </div>

        <!-- Add New Pet Button (Top Right) -->
        <button onclick="openAddPetModal()" 
                class="px-8 py-4 rounded-full text-xs font-bold uppercase tracking-widest bg-gradient-to-r from-[#F87004] to-[#FFB347] text-white shadow-md shadow-orange-100 hover:scale-[1.02] active:scale-[0.98] transition-all flex items-center gap-2 whitespace-nowrap mt-2">
            <i data-lucide="plus" class="w-4 h-4"></i>
            Add Pet
        </button>
    </div>

    <!-- Search Bar -->
    <div class="mb-8">
        <div class="relative">
            <i data-lucide="search" class="absolute left-4 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"></i>
            <input type="text" 
                   id="searchInput"
                   placeholder="Search name or breed..." 
                   class="w-full pl-12 pr-6 py-4 bg-gray-50 border border-gray-200 rounded-full text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-[#56C2B1]/20 focus:border-[#56C2B1] transition-all" 
                   onkeyup="filterPets()" />
        </div>
    </div>

    <!-- Filter Section with Count -->
    <div class="mb-8 flex items-center justify-between flex-wrap gap-4">
        <div class="flex items-center gap-2">
            <h3 class="text-lg font-bold text-[#2D2D2D]">All Pets</h3>
            <span class="bg-[#F87004] text-white w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold" id="petCount">
                @Model.Count()
            </span>
        </div>

        <!-- Filter Group - Custom buttons for client-side filtering -->
        <div class="flex bg-gray-100/50 p-1.5 rounded-full border border-gray-100">
            <button type="button" onclick="filterByStatus('All')" class="filter-btn px-6 py-2 text-xs font-bold rounded-full transition-all no-underline flex items-center gap-2 bg-[#F87004] text-white shadow-sm" data-status="All">
                All <span class="text-[10px] opacity-70">(@statusCounts["All"])</span>
            </button>
            <button type="button" onclick="filterByStatus('Available')" class="filter-btn px-6 py-2 text-xs font-bold rounded-full transition-all text-gray-400 hover:text-gray-600" data-status="Available">
                Available <span class="text-[10px] opacity-70">(@statusCounts["Available"])</span>
            </button>
            <button type="button" onclick="filterByStatus('Pending')" class="filter-btn px-6 py-2 text-xs font-bold rounded-full transition-all text-gray-400 hover:text-gray-600" data-status="Pending">
                Pending <span class="text-[10px] opacity-70">(@statusCounts["Pending"])</span>
            </button>
            <button type="button" onclick="filterByStatus('Adopted')" class="filter-btn px-6 py-2 text-xs font-bold rounded-full transition-all text-gray-400 hover:text-gray-600" data-status="Adopted">
                Adopted <span class="text-[10px] opacity-70">(@statusCounts["Adopted"])</span>
            </button>
        </div>
    </div>

    <!-- Pet Grid -->
    <div id="petGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
        @foreach (var pet in Model)
        {
            <partial name="_PetCard" model="pet" />
        }
    </div>
</div>

<partial name="_AddPetModal" model="new PawsAndClaws.Models.ViewModels.AddPetViewModel()" />
<partial name="_EditPetModal" model="new PawsAndClaws.Models.Entities.Pet()" />

<script>
    let currentStatusFilter = 'All';

    // ==================== MODAL FUNCTIONS ====================
    function openAddPetModal() {
        document.getElementById('addPetModal').classList.remove('hidden');
    }

    function closeAddPetModal() {
        document.getElementById('addPetModal').classList.add('hidden');
    }

    function openEditPetModal() {
        document.getElementById('editPetModal').classList.remove('hidden');
    }

    function closeEditPetModal() {
        document.getElementById('editPetModal').classList.add('hidden');
    }

    // ==================== DELETE PET ====================
    function deletePet(petName) {
        if (confirm('Are you sure you want to delete ' + petName + '?')) {
            // TODO: Implement delete functionality
            console.log('Deleting pet:', petName);
        }
    }

    // ==================== FILTER STATUS ====================
    function filterByStatus(status) {
        currentStatusFilter = status;
        
        // Update button states
        document.querySelectorAll('.filter-btn').forEach(btn => {
            if (btn.getAttribute('data-status') === status) {
                btn.classList.remove('text-gray-400', 'hover:text-gray-600');
                btn.classList.add('bg-[#F87004]', 'text-white', 'shadow-sm');
            } else {
                btn.classList.add('text-gray-400', 'hover:text-gray-600');
                btn.classList.remove('bg-[#F87004]', 'text-white', 'shadow-sm');
            }
        });
        
        filterPets();
    }

    // ==================== FILTER AND SEARCH ====================
    function filterPets() {
        const searchInput = document.getElementById('searchInput').value.toLowerCase();
        const petCards = document.querySelectorAll('.pet-card');
        let visibleCount = 0;

        petCards.forEach(card => {
            const name = card.getAttribute('data-name') || '';
            const breed = card.getAttribute('data-breed') || '';
            const status = card.getAttribute('data-status') || '';

            const matchesSearch = name.includes(searchInput) || breed.includes(searchInput);
            const matchesStatus = currentStatusFilter === 'All' || status.toLowerCase() === currentStatusFilter.toLowerCase();

            if (matchesSearch && matchesStatus) {
                card.style.display = '';
                visibleCount++;
            } else {
                card.style.display = 'none';
            }
        });

        document.getElementById('petCount').textContent = visibleCount;
    }

    // ==================== MODAL CLOSE HANDLERS ====================
    document.addEventListener('click', function(event) {
        const addModal = document.getElementById('addPetModal');
        if (event.target === addModal) {
            closeAddPetModal();
        }

        const editModal = document.getElementById('editPetModal');
        if (event.target === editModal) {
            closeEditPetModal();
        }
    });

    // ==================== DROPDOWN MENU LOGIC ====================
    document.addEventListener('DOMContentLoaded', function() {
        const dropdownTriggers = document.querySelectorAll('.dropdown-trigger');
        
        dropdownTriggers.forEach(trigger => {
            trigger.addEventListener('click', function(e) {
                e.stopPropagation();
                const menu = this.nextElementSibling;
                
                // Close all other menus
                document.querySelectorAll('.dropdown-menu').forEach(m => {
                    if (m !== menu) m.classList.add('hidden');
                });
                
                menu.classList.toggle('hidden');
            });
        });

        // Close dropdowns when clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.dropdown-container')) {
                document.querySelectorAll('.dropdown-menu').forEach(m => {
                    m.classList.add('hidden');
                });
            }
        });
    });

    // Initialize Lucide icons
    if (typeof lucide !== 'undefined') {
        lucide.createIcons();
    }
</script>